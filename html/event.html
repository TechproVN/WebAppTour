<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Bootstrap core css -->
  <link rel="stylesheet" href="../MDB Free/css/bootstrap.min.css">

  <!-- Meterial Design Bootstrap -->
  <link rel="stylesheet" href="../MDB Free/css/mdb.min.css">

  <!-- datepicker css -->
  <link rel="stylesheet" href="../plugins/bootstrap-datetimepicker/css/bootstrap-datepicker3.min.css">

  <!-- leaflet css cdn -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin="" />

  <!-- map box css cdn -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css' rel='stylesheet' />

  <!-- bootstrap datetime picker css -->
  <link rel="stylesheet" href="../plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">

  <!-- main view custom css -->
  <link rel="stylesheet" href="../custom/css/main.css">

  <!-- custom main css -->
  <link rel="stylesheet" href="../custom/css/mainView.css">

  <title>Tracking list</title>
</head>

<body>
  <!-- navbar start-->
  <nav class="navbar navbar-expand-lg bg-main-color white-text">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fa fa-shield icon-custom" style="color: whitesmoke"></i>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <i class="fa fa-bars icon-custom" style="color: white"></i>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="	fa fa-book icon-navbar"></i>Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="fa fa-rotate-right icon-navbar"></i>Refresh
            </a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <!-- <li class="nav-item">
            <a href="" class="nav-link">
            <i class="fa fa-file-sound-o icon-navbar"></i>Mute
          </a>
        </li>
          <li class="nav-item">
            <a href="" class="nav-link">
            <i class="fa fa-question-circle-o icon-navbar"></i>Help
            </a>
          </li>
          <li class="nav-item">
            <a href="" class="nav-link">
              <i class="fa fa-cog icon-navbar"></i>Iosdemo
            </a>
          </li> -->
        </ul>
      </div>
    </div>
  </nav>
  <!-- navbar end -->

  <div class="container-fluid">

    <div class="row my-3 row-custom">
      <!-- filter and incident card -->
      <div class="col-md-3">
        <!-- card filter start -->
        <div class="card card filter">
          <div class="card-header bg-main-color custom-card-header">
            <h4>
              <i class="fa fa-filter"></i> Filters
            </h4>
          </div>
          <div class="card-body custom-card-body">
            <!-- <div class="col-md-6">
                <span class="">From</span>
                <div class="input-group date" data-provide="datepicker">
                  <input type="text" class="form-control input-custom">
                  <div class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                  </div>
                </div>
                <span class="">To</span>
                <div class="input-group date" data-provide="datepicker">
                  <input type="text" class="form-control input-custom">
                  <div class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                  </div>
                </div>
              </div> -->
            <!-- <div class="col-md-6">
                <select name="" id="clientCombobox" class="form-control combobox-custom">
                  <option value="" class="combobox-custom">Client 1</option>
                  <option value="">Client 2</option>
                  <option value="">Client 3</option>
                </select>
                <br>
                <select name="" id="siteCombobox" class="form-control">
                  <option value="">Client 1</option>
                  <option value="">Client 2</option>
                  <option value="">Client 3</option>
                </select>
                <br>
                <select name="" id="guardCombobox" class="form-control">
                  <option value="">Client 1</option>
                  <option value="">Client 2</option>
                  <option value="">Client 3</option>
                </select>
              </div> -->
            <div class="row">
              <div class="col-12">
                <label for="">From</label>
                <br>
                <input type="text" readonly class="datetimepicker" class="form-control" style="width: 100%" id="fromDateTime">
              </div>
            </div>

            <div class="row">
              <div class="col-12">
                <label for="">To</label>
                <br>
                <input type="text" readonly class="datetimepicker" class="form-control" style="width: 100%" id="toDateTime">
              </div>
            </div>

            <div class="row mt-3">
              <button class="btn btn-custom bg-main-color">Export</button>
              <button class="btn btn-custom bg-main-color">View</button>
            </div>
          </div>
        </div>
        <!-- card filter end -->
      </div>

      <div class="col-md-9">

        <!-- card incident start -->
        <div class="card card-incident">
          <div class="card-header bg-main-color custom-card-header">
            <h4>
              <i class="fa fa-exclamation-triangle"></i> Tracking lists</h4>
          </div>
          <div class="card-body custom-card-body table-responsive">

            <table class="table table-hover table-striped table-condensed text-center custom-table" id="tblEvents">
              <!-- incident content here -->
            </table>
          </div>
        </div>
        <!-- card incident end -->
      </div>
    </div>

  </div>

  <!-- JQuery core -->
  <script src="../MDB Free/js/jquery-3.3.1.min.js"></script>

  <!-- popper js core -->
  <script src="../MDB Free/js/popper.min.js"></script>

  <!-- bootstrap js core -->
  <script src="../MDB Free/js/bootstrap.min.js"></script>

  <!-- Meterail Design Bootstrap JS -->
  <script src="../MDB Free/js/mdb.min.js"></script>

  <!-- bootstrap datepicker js -->
  <script src="../plugins/bootstrap-datetimepicker/js/bootstrap-datepicker.min.js"></script>

  <!-- datetimepicker js -->
  <script src="../plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>

  <!-- leaflet js CDN -->
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>

  <!-- mapbox js CDN -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>

  <!-- custom main.jc -->
  <script src="../custom/js/main.js"></script>
  <script>
    $(() => {

      $('#fromDateTime').change(getEventsData);
      $('#toDateTime').change(getEventsData);

    })

    async function getEventsData() {
      let fromTime = $('#fromDateTime').val();
      let toTime = $('#toDateTime').val();

      if (fromTime != '' && toTime != '') {
        let sentData = {
          fromDate: fromTime,
          toDate: toTime
        };

        let data = await $.ajax({
          url: 'http://115.79.27.219/tracking/api/GetEventHistory.php',
          method: 'post',
          data: JSON.stringify(sentData)
        });
        if (data) renderEventsTable(JSON.parse(data));
      }
    }


    // async function showEventsInfo() {
    //   let data = await getEvensData();
    //   if (data) renderEventsTable(JSON.parse(data));
    // }

    function renderEventsTable(data) {
      console.log('data: '+data)

      let $table = $('#tblEvents')
      $table.html('');
      let $thead = $('<thead></thead>');
      let $tbody = $('<tbody></tbody>');

      $thead.html(
          `
          <tr>
            <th class="trn">Name</th>
            <th class="trn">Zone</th>
			<th class="trn">Date</th>
            <th class="trn">Start</th>
            <th class="trn">End</th>
			<th class="trn">Time</th>
			<th class="trn">Point</th>
			<th class="trn">Checked</th>
            <th class="trn">Distance</th>
            <th class=trn""></th>
          </tr>
        `
      )

      let htmltBody = '';
      data.forEach(event => {
        htmltBody +=
          `
          <tr>
            <td>${event.sGuardName}</td>
            <td>${event.sZoneName}</td>
			<td>${event.dDateTimeIntinial}</td>
            <td>${event.dDateTimeStart}</td>
            <td>${event.dDateTimeEnd}</td>
            <td>${event.iTimeCurrent}</td>
			<td>${event.iCountPoint}</td>
			<td>${event.iCheckedPoint}</td>
            <td>${event.dDistance}</td>
            <td><button class="btn btn-custom bg-main-color" onClick = "showIncidentDetails('${event.sCheckingCode}')">Details</button></td>
          </tr>
        `
      })
      $tbody.html(htmltBody);

      $table.append($thead).append($tbody);
    }

    function showIncidentDetails(checkingCode) {
      alert(checkingCode);
    }
  </script>
</body>

</html>